// (C) 2021 GoodData Corporation
import { LRUCache } from "@gooddata/util";
import { objRefToString } from "@gooddata/sdk-model";
import { DASHBOARD_CACHE_SIZE } from "./constants";
import { dataLoaderAbstractFactory } from "./DataLoaderAbstractFactory";
var DashboardDataLoader = /** @class */ (function () {
    function DashboardDataLoader(workspace) {
        this.workspace = workspace;
        this.dashboardCache = new LRUCache({ maxSize: DASHBOARD_CACHE_SIZE });
    }
    DashboardDataLoader.prototype.getDashboard = function (backend, ref) {
        var _this = this;
        var cacheKey = objRefToString(ref);
        var dashboard = this.dashboardCache.get(cacheKey);
        if (!dashboard) {
            dashboard = backend
                .workspace(this.workspace)
                .dashboards()
                .getDashboard(ref)
                .catch(function (error) {
                _this.dashboardCache.delete(cacheKey);
                throw error;
            });
            this.dashboardCache.set(cacheKey, dashboard);
        }
        return dashboard;
    };
    return DashboardDataLoader;
}());
/**
 * @internal
 */
export var dashboardDataLoaderFactory = dataLoaderAbstractFactory(function (workspace) { return new DashboardDataLoader(workspace); });
//# sourceMappingURL=DashboardDataLoader.js.map